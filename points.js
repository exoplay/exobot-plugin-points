require("source-map-support").install();
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@exoplay/exobot")):"function"==typeof define&&define.amd?define(["@exoplay/exobot"],e):"object"==typeof exports?exports["points.js"]=e(require("@exoplay/exobot")):t["points.js"]=e(t["@exoplay/exobot"])}(this,function(t){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,e,r){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var r=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e){t.exports=require("@exoplay/exobot")},function(t,e,r){"use strict";function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,r){function n(o,i){try{var s=e[o](i),a=s.value}catch(u){return void r(u)}return s.done?void t(a):Promise.resolve(a).then(function(t){return n("next",t)},function(t){return n("throw",t)})}return n("next")})}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e,r,n,o){var i={};return Object.keys(n).forEach(function(t){i[t]=n[t]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,n){return n(t,e,r)||r},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(t,e,i),i=null),i}var u=r(0),p=(r.n(u),r(2)),c=r.n(p);r.d(e,"nameToId",function(){return R}),r.d(e,"Points",function(){return E});var f,l,h,y,d,b,v,m,g,w,x,j,O,P=function(){function t(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(u){o=!0,i=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),R=function(t){return t.trim().replace(/[^\w]/g,"").toLowerCase()},z=/^([\s\w@.\-']+):?\s*([\+\-]{2})(?:\s+for (.*))?$/,_=/^([\+\-]{2})(?:\s+for (.*))?$/,E=(f=r.i(u.permissionGroup)("points"),l=r.i(u.help)('thing++ or thing-- to add or remove points. Optionally, "thing++ for <reason>"'),h=r.i(u.listen)(z),y=r.i(u.permissionGroup)("points"),d=r.i(u.help)("++ or -- alone will add (or remove) points from the most recently up/downvoted thing"),b=r.i(u.listen)(_),v=r.i(u.permissionGroup)("points"),m=r.i(u.help)("/top <n> to show top <n> users."),g=r.i(u.respond)(/^tops?\s*(\d*)?$/i),w=r.i(u.permissionGroup)("points"),x=r.i(u.help)("/score <user> to show score for a user."),j=r.i(u.respond)(/^score(?: for)?(.*)$/i),O=function(t){function e(){var t,r,n,s;o(this,e);for(var a=arguments.length,u=Array(a),p=0;p<a;p++)u[p]=arguments[p];return r=n=i(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(u))),n.name="points",n.defaultDatabase={points:{things:{},tops:[]}},s=r,i(n,s)}return s(e,t),k(e,[{key:"changePoints",value:function(){function t(t){return e.apply(this,arguments)}var e=n(regeneratorRuntime.mark(function r(t){var e,n,o,i,s,a=P(t,4),u=a[1],p=a[2],c=a[3];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.lastVote={name:u,change:p,reason:c},e=R(u),t.next=4,this.databaseInitialized();case 4:return n=this.bot.db.get("points.things."+e).value(),n||(n=this.buildPoints(u,e)),"++"===p?n.points=n.points+1:n.points=n.points-1,o=[u+" has "+n.points+" points"],c&&(i=R(c),s=n.reasons[i]||{score:0,reason:c},s.score++,n.reasons[i]=s,o.push([s.score+" of which "+(1===s.score?"is":"are")+" for "+c])),this.bot.db.set("points.things."+e,n).value(),this.bot.db.write(),this.updateTops(),t.abrupt("return",o.join(", "));case 13:case"end":return t.stop()}},r,this)}));return t}()},{key:"repeat",value:function(){function t(t,r){return e.apply(this,arguments)}var e=n(regeneratorRuntime.mark(function r(t,e){var n=P(t,3),o=n[1],i=n[2];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.changePoints([void 0,this.lastVote.name,o,i||this.lastVote.reason],e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},r,this)}));return t}()},{key:"tops",value:function(){function t(t){return e.apply(this,arguments)}var e=n(regeneratorRuntime.mark(function r(t){var e,n,o,i=P(t,2),s=i[1],a=void 0===s?10:s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.databaseInitialized();case 2:return a>25&&(a=25),e=this.bot.db.get("points.things").value(),n=this.bot.db.get("points.tops").slice(0,a).value(),o=[c()(n.map(function(t){return e[t].points}))],o.push("Top "+Math.min(a,n.length)+":"),n.forEach(function(t){return o.push(e[t].name+": "+e[t].points)}),t.abrupt("return",o.join("\n"));case 9:case"end":return t.stop()}},r,this)}));return t}()},{key:"score",value:function(){function t(t){return e.apply(this,arguments)}var e=n(regeneratorRuntime.mark(function r(t){var e,n,o,i,s,a=P(t,2),u=a[1];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u=u.trim(),e=R(u),t.next=4,this.databaseInitialized();case 4:return n=this.bot.db.get("points.things."+e).value(),o=n.reasons,i=[u+" has "+n.points+" points."],s=Object.keys(n.reasons),s.length>0&&(i.push("Here are some reasons:"),s.forEach(function(t){i.push(o[t].reason+": "+o[t].score+" points")})),t.abrupt("return",i.join("\n"));case 10:case"end":return t.stop()}},r,this)}));return t}()},{key:"updateTops",value:function(){function t(){return e.apply(this,arguments)}var e=n(regeneratorRuntime.mark(function r(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseInitialized();case 2:t=this.bot.db.get("points.things").orderBy("points","desc").map("id").value(),this.bot.db.set("points.tops",t).value(),this.bot.db.write();case 5:case"end":return e.stop()}},r,this)}));return t}()},{key:"buildPoints",value:function(t,e){return{name:t,id:e,points:0,reasons:{}}}}]),e}(u.ChatPlugin),a(O.prototype,"changePoints",[f,l,h],Object.getOwnPropertyDescriptor(O.prototype,"changePoints"),O.prototype),a(O.prototype,"repeat",[y,d,b],Object.getOwnPropertyDescriptor(O.prototype,"repeat"),O.prototype),a(O.prototype,"tops",[v,m,g],Object.getOwnPropertyDescriptor(O.prototype,"tops"),O.prototype),a(O.prototype,"score",[w,x,j],Object.getOwnPropertyDescriptor(O.prototype,"score"),O.prototype),O)},function(t,e,r){var n,o;(function(r){var i=["▁","▂","▃","▄","▅","▆","▇"],s=function(t){var e,r,n,o=Math.min.apply(Math,t),s=(Math.max.apply(Math,t)-o)/(i.length-1),a=[];for(r=0,n=t.length;r<n;r++)e=t[r],a.push(i[(e-o)/s>>0]);return a.join("")};"undefined"!=typeof t&&t.exports?t.exports=s:(n=[],o=function(){return r.clark=s,s}.apply(e,n),!(void 0!==o&&(t.exports=o)))}).call(this)}])});
//# sourceMappingURL=points.js.map