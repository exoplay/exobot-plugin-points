require("source-map-support").install();
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@exoplay/exobot")):"function"==typeof define&&define.amd?define(["@exoplay/exobot"],e):"object"==typeof exports?exports["points.js"]=e(require("@exoplay/exobot")):t["points.js"]=e(t["@exoplay/exobot"])}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,e,n){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e){t.exports=require("@exoplay/exobot")},function(t,e,n){"use strict";function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(o,i){try{var s=e[o](i),u=s.value}catch(a){return void n(a)}return s.done?void t(u):Promise.resolve(u).then(function(t){return r("next",t)},function(t){return r("throw",t)})}return r("next")})}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=n(0),a=u&&u.__esModule?function(){return u["default"]}:function(){return u};n.d(a,"a",a),n.d(e,"nameToId",function(){return l});var c=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var s,u=t[Symbol.iterator]();!(r=(s=u.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(a){o=!0,i=a}finally{try{!r&&u["return"]&&u["return"]()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),f=function d(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:d(o,e,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},l=function(t){return t.replace(/[^\w]/g,"")},h=function(t){function e(){o(this,e);var t=i(this,Object.getPrototypeOf(e).apply(this,arguments));return t.help=["Points: add points to things. `thing++` or `thing--` adds or removes","points. Users are rate-limited from voting on the same thing multiple","times. Optionally add reasons: `thing++ for my reasons`."].join(" "),t.listen(/^([\s\w'@.\-:]*)\s*\+\+(?:\s+for (.*))?$/i,function(e){return t.changePoints(e,1)}),t.listen(/^([\s\w'@.\-:]*)\s*\-\-(?:\s+for (.*))?$/i,function(e){return t.changePoints(e,-1)}),t.respond(/^tops?\s*(\d*)?$/i,t.tops),t.respond(/^score(?: for)?(.*)$/i,t.score),t}return s(e,t),p(e,[{key:"register",value:function(t){f(Object.getPrototypeOf(e.prototype),"register",this).call(this,t),this.database("points",{things:{},tops:[]})}},{key:"changePoints",value:function(){function t(t,n){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function n(t,e){var r,o,i,s,u=c(t,3),a=(u[0],u[1]),p=u[2];return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=a.trim(),r=l(a),t.next=4,this.databaseInitialized();case 4:return o=this.bot.db.get("points.things."+r).value(),o||(o=this.buildPoints(a,r)),o.points=o.points+e,p&&(i=l(p),s=o.reasons[i]||{score:0,reason:p},s.score++,o.reasons[i]=s),this.bot.db.set("points.things."+r,o).value(),this.bot.db.write(),this.updateTops(),t.abrupt("return",a+" has "+o.points+" points.");case 12:case"end":return t.stop()}},n,this)}));return t}()},{key:"tops",value:function(){function t(t){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function n(t){var e,r,o,i=c(t,2),s=(i[0],i[1]),u=void 0===s?10:s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.databaseInitialized();case 2:return u>25&&(u=25),e=this.bot.db.get("points.things").value(),r=this.bot.db.get("points.tops").slice(0,u).value(),o=["Top "+Math.min(u,r.length)+":"],r.forEach(function(t){return o.push(e[t].name+": "+e[t].points)}),t.abrupt("return",o.join("\n"));case 8:case"end":return t.stop()}},n,this)}));return t}()},{key:"score",value:function(){function t(t){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function n(t){var e,r,o,i,s,u=c(t,2),a=(u[0],u[1]);return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=a.trim(),e=l(a),t.next=4,this.databaseInitialized();case 4:return r=this.bot.db.get("points.things."+e).value(),o=r.reasons,i=[a+" has "+r.points+" points."],s=Object.keys(r.reasons),s.length>0&&(i.push("Here are some reasons:"),s.forEach(function(t){i.push(o[t].reason+": "+o[t].score+" points")})),t.abrupt("return",i.join("\n"));case 10:case"end":return t.stop()}},n,this)}));return t}()},{key:"updateTops",value:function(){function t(){return e.apply(this,arguments)}var e=r(regeneratorRuntime.mark(function n(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseInitialized();case 2:t=this.bot.db.get("points.things").orderBy("points","desc").map("id").value(),this.bot.db.set("points.tops",t).value(),this.bot.db.write();case 5:case"end":return e.stop()}},n,this)}));return t}()},{key:"buildPoints",value:function(t,e){return{name:t,id:e,points:0,reasons:{}}}}]),e}(u.ChatPlugin);e["default"]=h}])});
//# sourceMappingURL=points.js.map